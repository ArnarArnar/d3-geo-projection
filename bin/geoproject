#!/usr/bin/env node

var commander = require("commander"),
    vm = require("vm"),
    d3Geo = require("d3-geo"),
    d3GeoProjection = require("../"),
    geotransform = require("./geotransform");

commander
    .version(require("../package.json").version)
    .usage("[options] <projection>")
    .description("Transform GeoJSON, such as to project from spherical to planar coordinates.")
    .option("-i, --in <file>", "input file name; defaults to “-” for stdin", "-")
    .option("-o, --out <file>", "output file name; defaults to “-” for stdout", "-")
    .option("-n, --newline-delimited", "use newline-delimited JSON")
    .parse(process.argv);

if (commander.args.length !== 1) {
  console.error();
  console.error("  error: invalid or missing projection");
  console.error();
  process.exit(1);
}

var projection = vm.runInNewContext("(" + commander.args[0] + ")", {
  d3: Object.assign({}, d3Geo, d3GeoProjection)
});

geotransform(function(object) {
  return d3GeoProjection.geoProject(object, projection);
});
